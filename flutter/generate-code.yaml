version: '3'

tasks:
  generate-code:
    dir: '{{ .dir }}'
    requires:
      vars:
        - name: dir
    vars:
      watch: '{{.watch | default false}}'
    cmds:
      - task: :print
        vars: { msg: 'Generating code', state: 'info' }
      # Run build_runner
      - |
        git rev-parse --show-toplevel 2>/dev/null || echo "not a git repo"
        pwd
        if [ "{{.watch}}" = true ]; then
          dart run build_runner watch -d
        else
          dart run build_runner build -d
        fi
